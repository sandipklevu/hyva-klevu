!function(e){if(e.recs&&e.recs.base){e.extend(!0,e.dom.helpers,{escapeHTML:function(e){if(e&&e.length){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,(function(e){return t[e]}))}return e},cleanUpProductImage:function(t){var a=t.getAttribute("src");if(a&&a.length){var c="";if(c="function"==typeof e.search.modules.kmcInputs.base.getKMCUserOptionsNoImageUrl?e.search.modules.kmcInputs.base.getKMCUserOptionsNoImageUrl():"https://js.klevu.com/klevu-js-v1/img-1-1/place-holder.jpg",t.src.indexOf(c)>-1)return t.src="",void(t.onerror="");if(t.src.indexOf("/pub")>-1)t.src=t.src.replace("/pub",""),t.onerror=function(){t.src=c,t.onerror=""};else{var s=t.src.indexOf("/media")>-1,n=t.src.indexOf("needtochange/")>-1,o=t.getAttribute("origin");n?t.src=t.src.replace("needtochange/",""):s?t.src=t.src.replace("/media","/pub/media"):o&&(t.src=o.replace("needtochange/","pub/"),t.onerror=function(){t.src=c,t.onerror=""})}}else{c="";c="function"==typeof e.search.modules.kmcInputs.base.getKMCUserOptionsNoImageUrl?e.search.modules.kmcInputs.base.getKMCUserOptionsNoImageUrl():"https://js.klevu.com/klevu-js-v1/img-1-1/place-holder.jpg",t.src=c,t.onerror=""}},readCookie:function(t){var a=e.isFunction(e.support.isActive)?e.support.isActive("dataProtection"):!e.isUndefined(e.support.dataProtection);if(t===e.getGlobalSetting("constants.COOKIE_KLEVU_RCP")&&a&&e.dataProtection.getUseConsent()&&!e.dataProtection.dataCanBeTracked())return"";var c=" "+document.cookie,s=c.indexOf(" "+t+"="),n=c.indexOf(";",s+1);return-1===s&&(s=c.indexOf(";"+t+"=")),-1===s||""===t?"":(-1===(n=c.indexOf(";",s+1))&&(n=c.length),decodeURIComponent(c.substring(s+t.length+2,n)))},addClickedProductToCookie:function(t){if((e.isFunction(e.support.isActive)?e.support.isActive("dataProtection"):!e.isUndefined(e.support.dataProtection))&&e.dataProtection.getUseConsent()&&!e.dataProtection.dataCanBeTracked())return!1;var a,c=window.btoa(t),s=e.dom.helpers.readCookie(e.settings.constants.COOKIE_KLEVU_RCP),n=c,o=new Date,r="undefined"!=typeof klevu_setHttpOnlyToCookies&&klevu_setHttpOnlyToCookies?"; HttpOnly":"";s&&""!==s.trim()&&(-1!==(a=s.split("#-#")).indexOf(c)?a.splice(a.indexOf(c),1):a.length>=20&&a.splice(-1,1),a.splice(0,0,c),n=a.join("#-#")),o.setTime(o.getTime()+31536e6),document.cookie=e.settings.constants.COOKIE_KLEVU_RCP+"="+n+";expires="+o.toUTCString()+";path=/;SameSite=None; Secure"+r}}),e({storage:{recs:e.dictionary("analyticsEvents")},constants:{COOKIE_KLEVU_RCP:"",RECS_QUERY_ID:"klevuRECSItemList",RECS_PT_HOME:"HOME",RECS_PT_CATEGORY:"CATEGORY",RECS_PT_PRODUCT:"PRODUCT",RECS_PT_CHECKOUT:"CHECKOUT",RECS_LC_TRENDING:"TRENDING",RECS_LC_TRENDING_PERSONALIZED:"TRENDING_PERSONALIZED",RECS_LC_NEWEST_ARRIVALS:"NEWEST_ARRIVALS",RECS_LC_RECENTLY_VIEWED:"RECENTLY_VIEWED",RECS_LC_HAND_PICKED:"HAND_PICKED",RECS_LC_OTHER_ALSO_VIEWED:"OTHER_ALSO_VIEWED",RECS_LC_SIMILAR:"SIMILAR",RECS_LC_BOUGHT_TOGETHER:"BOUGHT_TOGETHER",RECS_LC_BOUGHT_TOGETHER_PDP:"BOUGHT_TOGETHER_PDP",RECS_LC_VISUALLY_SIMILAR:"VISUALLY_SIMILAR",RECS_LC_RECS_CUSTOM:"CUSTOM_LOGIC",RECS_RPT:"recsPageType:"}}),e.setObjectPath(e.recs.base.getScope(),"chains.type.staticContent",e.chain({stopOnFalse:!0})),e.setObjectPath(e.recs.base.getScope(),"chains.type.hideBanner",e.chain({stopOnFalse:!0})),e.recs.base.getScope().chains.response.success.addBefore("executeSearchObjectPowerUp",{name:"checkForHideBanner",fire:function(t,a){if("HIDE_RECOMMENDATION"===e.getObjectPath(a.recsScope,"kmcData.metadata.action",!1)){var c=e.getObjectPath(a.recsScope,"chains.type.hideBanner");return e.isUndefined(c)||0===c.list().length||(c.setScope(a.recsElem),c.setData(t),c.fire()),!1}}}),e.recs.base.getScope().chains.response.success.addBefore("executeSearchObjectPowerUp",{name:"checkForStaticContent",fire:function(t,a){if("STATIC_CONTENT"===e.getObjectPath(a.recsScope,"kmcData.metadata.action",!1)){var c=e.getObjectPath(a.recsScope,"chains.type.staticContent");return e.isUndefined(c)||0===c.list().length||(c.setScope(a.recsElem),c.setData(t),c.fire()),!1}}}),e.recs.base.getScope().chains.response.success.move({name:"buildTheSearchObject",before:"executeSearchObjectPowerUp"});var t=e.recs.base;t.getScope().chains.search.control.add({name:"checkRecsAction",fire:function(t,a){if("HIDE_RECOMMENDATION"===e.getObjectPath(a.recsScope,"kmcData.search.recsAction"))return!1}}),t.getScope().chains.search.control.add({name:"validateRECSElementData",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey");if(!c)return console.info("RECS element id is missing."),!1;if(!e.getObjectPath(a.recsScope,"kmcData.metadata.enabled"))return console.info("["+c+"] element is disabled."),!1;var s=!1;e.getObjectPath(a.recsScope,"kmcData.metadata.logic")||(console.info("["+c+"] RECS logic is missing."),s=!0),e.getObjectPath(a.recsScope,"kmcData.metadata.pageType")||(console.info("["+c+"] RECS page type is missing."),s=!0);var n=e.getObjectPath(a.recsScope,"kmcData.metadata.maxProducts");void 0!==n&&""!==n||e.setObjectPath(a.recsScope,"kmcData.metadata.maxProducts",12);var o=e.getObjectPath(a.recsScope,"kmcData.metadata.productThreshold");if(void 0!==o&&""!==o||e.setObjectPath(a.recsScope,"kmcData.metadata.productThreshold",4),s)return!1;a.recsScope.searchObject.getScope().parentScope=a.recsScope}}),t.getScope().chains.search.control.add({name:"addElementStylesToHead",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey"),s=e.getObjectPath(a.recsScope,"kmcData.styles.base");c&&e.each(e.dom.find("#ku-recs-"+c),(function(e,t){t&&t.parentNode&&t.parentNode.removeChild(t)})),e.dom.helpers.addElementToHead({content:s,type:"css",name:"ku-recs-"+c})}}),t.getScope().chains.search.control.add({name:"createStorageForRECS",fire:function(t,a){var c=e.getSetting(a.recsScope.settings,"settings.storage");c.recs.setStorage("local"),c.recs.mergeFromGlobal(),c.recs.mergeToGlobal()}}),t.getScope().chains.search.control.add({name:"addSearchSettings",fire:function(t,a){var c=e.getSetting(a.recsScope,"settings.recs.apiKey",e.getGlobalSetting("recs.apiKey",e.getGlobalSetting("global.apiKey"))),s=e.getObjectPath(a.recsScope,"kmcData.search.basePath"),n=c.replace(/-/g,"_");e.setObjectPath(e.settings,"constants.COOKIE_KLEVU_RCP","klevu_rcp_"+n);var o=a.recsScope.searchObject;e.setSetting(o.getScope().settings,"settings.search.apiKey",c),e.setSetting(o.getScope().settings,"settings.analytics.apiKey",c),e.setSetting(o.getScope().settings,"settings.search.minChars",1),e.setSetting(o.getScope().settings,"settings.url.search","https://"+s)}}),t.getScope().chains.search.control.add({name:"registerRECSTemplate",fire:function(t,a){var c=a.recsScope.searchObject,s=e.getObjectPath(a.recsScope,"kmcData.templates.base");c.getScope().template.setTemplate(s,"kuRECSTemplate",!0)}}),t.getScope().chains.search.control.add({name:"populateSearchQueryData",fire:function(t,a){var c=a.recsScope.searchObject;c.getScope().chains.request.build.add({name:"addSearchQuery",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.search.payload");try{var s=JSON.parse(c),n=s&&s.recordQueries?s.recordQueries:[];e.setObjectPath(t,"request.current.recordQueries",n),t.context.doSearch=!0}catch(e){console.error(e)}}}),c.getScope().chains.request.build.add({name:"addStoredProductIdsV1",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.maxProducts"),s=e.dom.helpers.readCookie(e.settings.constants.COOKIE_KLEVU_RCP);if(t.context.storedProductIds=[],s&&""!==s.trim()){var n=[];s.split("#-#").forEach((function(e){n.length<c&&n.push(atob(e))})),t.context.storedProductIds=n}}}),c.getScope().chains.request.build.add({name:"addTrendingProductsQueryOp",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_TRENDING){var s=e.getObjectPath(t,"request.current.recordQueries");s&&e.each(s,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID&&c==e.settings.constants.RECS_PT_CATEGORY){var s="";"category"===e.pageMeta.getPageType()&&(s=e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath"))),e.setObjectPath(a,"settings.query.categoryPath",s)}}))}}}),c.getScope().chains.request.build.add({name:"addTrendingProductsWithPersonalizationQueryOp",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_TRENDING_PERSONALIZED){var s=e.getObjectPath(t,"request.current.recordQueries");s&&e.each(s,(function(a,s){if(s.id==e.settings.constants.RECS_QUERY_ID){var n=[],o=e.getObjectPath(s,"settings.context.recentObjects");o&&o.length&&(n=o);var r=t.context.storedProductIds;if(r&&r.length){var i={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(r,(function(e,t){i.records.push({id:t})})),n.push(i)}if(e.setObjectPath(s,"settings.context.recentObjects",n),c==e.settings.constants.RECS_PT_CATEGORY){var p="";"category"===e.pageMeta.getPageType()&&(p=e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath"))),e.setObjectPath(s,"settings.query.categoryPath",p)}}}))}}}),c.getScope().chains.request.build.add({name:"addNewestArrivalsQueryOp",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_NEWEST_ARRIVALS){var s=e.getObjectPath(t,"request.current.recordQueries");s&&e.each(s,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID&&c==e.settings.constants.RECS_PT_CATEGORY){var s="";"category"===e.pageMeta.getPageType()&&(s=e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath"))),e.setObjectPath(a,"settings.query.categoryPath",s)}}))}}}),c.getScope().chains.request.build.add({name:"addRecentlyViewedQueryOp",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_RECENTLY_VIEWED){var s=e.getObjectPath(t,"request.current.recordQueries");if(s){if(!t.context.storedProductIds||0==t.context.storedProductIds.length)return t.context.doSearch=!1,!1;e.each(s,(function(a,s){if(s.id==e.settings.constants.RECS_QUERY_ID){var n=t.context.storedProductIds,o="",r=[];if(n&&n.length&&(e.each(n,(function(e,t){e>0&&(o+=" OR "),o+='"'+t+'"',r.push({key:"id",value:t})})),e.setObjectPath(s,"settings.customANDQuery","id:("+o+")"),e.setObjectPath(s,"settings.topIds",r)),e.setObjectPath(s,"settings.limit",r.length),c==e.settings.constants.RECS_PT_CATEGORY){var i="";"category"===e.pageMeta.getPageType()&&(i=e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath"))),e.setObjectPath(s,"settings.query.categoryPath",i)}}}))}}}}),c.getScope().chains.request.build.add({name:"addHandPickedQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType"),e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic");e.settings.constants.HAND_PICKED}}),c.getScope().chains.request.build.add({name:"addOtherAlsoViewedQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_OTHER_ALSO_VIEWED){var c=e.getObjectPath(t,"request.current.recordQueries");c&&e.each(c,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){var c,s,n=[],o=e.getObjectPath(a,"settings.context.recentObjects");if(o&&o.length&&(n=o),"pdp"===e.pageMeta.getPageType()&&(e.pageMeta.hasData("page.pdp.products.0.itemGroupId")&&(s=e.pageMeta.getData("page.pdp.products.0.itemGroupId")),e.pageMeta.hasData("page.pdp.products.0.itemId")&&(c=e.pageMeta.getData("page.pdp.products.0.itemId"))),!c)return;var r=[c];if(r&&r.length){var i={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(r,(function(e,t){i.records.push({id:t})})),n.push(i)}if(s){var p=[{key:"itemGroupId",value:s}],d=e.getObjectPath(a,"settings.excludeIds",[]);d&&d.length&&(p=p.concat(d)),e.setObjectPath(a,"settings.excludeIds",p)}e.setObjectPath(a,"settings.context.recentObjects",n)}}))}}}),c.getScope().chains.request.build.add({name:"addRelatedQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_SIMILAR){var c=e.getObjectPath(t,"request.current.recordQueries");c&&e.each(c,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){var c,s,n=[],o=e.getObjectPath(a,"settings.context.recentObjects");if(o&&o.length&&(n=o),"pdp"===e.pageMeta.getPageType()&&(e.pageMeta.hasData("page.pdp.products.0.itemGroupId")&&(s=e.pageMeta.getData("page.pdp.products.0.itemGroupId")),e.pageMeta.hasData("page.pdp.products.0.itemId")&&(c=e.pageMeta.getData("page.pdp.products.0.itemId"))),!c)return;var r=[c];if(r&&r.length){var i={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(r,(function(e,t){i.records.push({id:t})})),n.push(i)}if(s){var p=[{key:"itemGroupId",value:s}],d=e.getObjectPath(a,"settings.excludeIds",[]);d&&d.length&&(p=p.concat(d)),e.setObjectPath(a,"settings.excludeIds",p)}e.setObjectPath(a,"settings.context.recentObjects",n)}}))}}}),c.getScope().chains.request.build.add({name:"addBoughtTogetherQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_BOUGHT_TOGETHER){var c=e.getObjectPath(t,"request.current.recordQueries");c&&e.each(c,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){var c=[],s=e.getObjectPath(a,"settings.context.recentObjects");s&&s.length&&(c=s);var n=[],o=[];if("cart"===e.pageMeta.getPageType()){var r=e.pageMeta.getData("page.cart.products",[]);r&&r.length&&e.each(r,(function(e,t){t.itemId&&n.push(t.itemId),t.itemGroupId&&o.push(t.itemGroupId)}))}if(!n.length)return;var i=n;if(i&&i.length){var p={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(i,(function(e,t){p.records.push({id:t})})),c.push(p)}if(o&&o.length>0){var d=[];e.each(o,(function(e,t){d.push({key:"itemGroupId",value:t})}));var g=e.getObjectPath(a,"settings.excludeIds",[]);g&&g.length&&(d=d.concat(g)),e.setObjectPath(a,"settings.excludeIds",d)}e.setObjectPath(a,"settings.context.recentObjects",c)}}))}}}),c.getScope().chains.request.build.add({name:"addBoughtTogetherPdpQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_BOUGHT_TOGETHER_PDP){var c=e.getObjectPath(t,"request.current.recordQueries");c&&e.each(c,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){var c,s,n=[],o=e.getObjectPath(a,"settings.context.recentObjects");if(o&&o.length&&(n=o),"pdp"===e.pageMeta.getPageType()&&(e.pageMeta.hasData("page.pdp.products.0.itemGroupId")&&(s=e.pageMeta.getData("page.pdp.products.0.itemGroupId")),e.pageMeta.hasData("page.pdp.products.0.itemId")&&(c=e.pageMeta.getData("page.pdp.products.0.itemId"))),!c)return;var r=[c];if(r&&r.length){var i={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(r,(function(e,t){i.records.push({id:t})})),n.push(i)}if(s){var p=[{key:"itemGroupId",value:s}],d=e.getObjectPath(a,"settings.excludeIds",[]);d&&d.length&&(p=p.concat(d)),e.setObjectPath(a,"settings.excludeIds",p)}e.setObjectPath(a,"settings.context.recentObjects",n)}}))}}}),c.getScope().chains.request.build.add({name:"addSimilarImagesQueryOp",fire:function(t,a){e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_VISUALLY_SIMILAR){var c=e.getObjectPath(t,"request.current.recordQueries");c&&e.each(c,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){var c,s,n=[],o=e.getObjectPath(a,"settings.context.sourceObjects");o&&o.length&&(n=o);var r,i={typeOfRecord:"KLEVU_PRODUCT",records:[]};if("pdp"===e.pageMeta.getPageType()&&(e.pageMeta.hasData("page.pdp.products.0.itemGroupId")&&(s=e.pageMeta.getData("page.pdp.products.0.itemGroupId"),i.records.push({itemGroupId:s})),e.pageMeta.hasData("page.pdp.products.0.itemId")&&(c=e.pageMeta.getData("page.pdp.products.0.itemId"),i.records.push({id:c}))),!c&&!s)return;if(n.push(i),s)r=[{key:"itemGroupId",value:s}],(p=e.getObjectPath(a,"settings.excludeIds",[]))&&p.length&&(r=r.concat(p)),e.setObjectPath(a,"settings.excludeIds",r);else if(c){var p;r=[{key:"id",value:c}],(p=e.getObjectPath(a,"settings.excludeIds",[]))&&p.length&&(r=r.concat(p)),e.setObjectPath(a,"settings.excludeIds",r)}e.setObjectPath(a,"settings.context.sourceObjects",n)}}))}}}),c.getScope().chains.request.build.add({name:"addCustomLogicQueryOp",fire:function(t,a){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType");if(e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic")==e.settings.constants.RECS_LC_RECS_CUSTOM){var s=e.getObjectPath(t,"request.current.recordQueries");s&&e.each(s,(function(t,a){if(a.id==e.settings.constants.RECS_QUERY_ID){if(c==e.settings.constants.RECS_PT_CATEGORY){let t="";"category"===e.pageMeta.getPageType()&&(t=e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath"))),e.setObjectPath(a,"settings.query.categoryPath",t)}if(c==e.settings.constants.RECS_PT_PRODUCT){let t,c,s=[],n=e.getObjectPath(a,"settings.context.recentObjects");if(n&&n.length&&(s=n),"pdp"===e.pageMeta.getPageType()&&(e.pageMeta.hasData("page.pdp.products.0.itemGroupId")&&(c=e.pageMeta.getData("page.pdp.products.0.itemGroupId")),e.pageMeta.hasData("page.pdp.products.0.itemId")&&(t=e.pageMeta.getData("page.pdp.products.0.itemId"))),!t)return;let o=[t];if(o&&o.length){let t={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(o,(function(e,a){t.records.push({id:a})})),s.push(t)}if(c){let t=[{key:"itemGroupId",value:c}],s=e.getObjectPath(a,"settings.excludeIds",[]);s&&s.length&&(t=t.concat(s)),e.setObjectPath(a,"settings.excludeIds",t)}e.setObjectPath(a,"settings.context.recentObjects",s)}if(c==e.settings.constants.RECS_PT_CHECKOUT){var s=[],n=e.getObjectPath(a,"settings.context.recentObjects");n&&n.length&&(s=n);var o=[],r=[];if("cart"===e.pageMeta.getPageType()){var i=e.pageMeta.getData("page.cart.products",[]);i&&i.length&&e.each(i,(function(e,t){t.itemId&&o.push(t.itemId),t.itemGroupId&&r.push(t.itemGroupId)}))}if(!o.length)return;var p=o;if(p&&p.length){var d={typeOfRecord:"KLEVU_PRODUCT",records:[]};e.each(p,(function(e,t){d.records.push({id:t})})),s.push(d)}if(r&&r.length>0){var g=[];e.each(r,(function(e,t){g.push({key:"itemGroupId",value:t})}));var u=e.getObjectPath(a,"settings.excludeIds",[]);u&&u.length&&(g=g.concat(u)),e.setObjectPath(a,"settings.excludeIds",g)}e.setObjectPath(a,"settings.context.recentObjects",s)}}}))}}}),c.getScope().chains.request.build.add({name:"processRecordQueries",fire:function(t,a){if("function"==typeof klevu_processRECSRecordQueries){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.recsKey");klevu_processRECSRecordQueries(t.request.current.recordQueries,c)}}})}}),t.getScope().chains.search.control.add({name:"processSearchResponse",fire:function(t,a){var c=a.recsScope.searchObject;c.getScope().chains.template.process.success.add({name:"processCurrencySetting",fire:function(t,a){var s=c.getScope().template.getTranslator().getCurrencyObject().getCurrencys(),n="";if(e.each(t.template.query,(function(t,a){""==n&&e.each(a.result,(function(e,t){t.currency&&t.currency.length&&(n=t.currency)}))})),n.length&&!s[n]){s[n]={string:n,format:"%s %s"};var o=c.getScope().template.getTranslator().getCurrencyObject();o.setCurrencys(s),o.mergeToGlobal()}}}),c.getScope().chains.template.process.success.add({name:"populateTemplateMetadata",fire:function(t,a){t.template.metadata=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata")}}),c.getScope().chains.response.success.addAfter("addResponseDataQuery",{name:"processQueryResults",fire:function(t,a){if("function"==typeof klevu_processRECSQueryResults){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.recsKey"),s=e.getObjectPath(t,"response.current.queryResults");klevu_processRECSQueryResults(s,c)}}}),c.getScope().chains.template.process.success.add({name:"processTemplateData",fire:function(t,a){if("function"==typeof klevu_processRECSTemplateData){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.recsKey");klevu_processRECSTemplateData(t.template,c)}}})}}),t.getScope().chains.search.control.add({name:"renderSearchResult",fire:function(t,a){a.recsScope.searchObject.getScope().chains.template.render.add({name:"renderResponse",fire:function(t,a){if(t.context.isSuccess){var c=e.getObjectPath(t,"template.metadata.productThreshold"),s=e.getObjectPath(t,"template.query."+e.settings.constants.RECS_QUERY_ID+".result");if(void 0!==c&&s&&s.length)if(c>s.length)return;a.kScope.template.setData(t.template);var n=a.kScope.template.convertTemplate(a.kScope.template.render("kuRECSTemplate")),o=e.getSetting(a.kScope.settings,"settings.search.searchBoxTarget");o.innerHTML="",o.classList.add("klevuTarget"),a.kScope.element.kData=t.template,a.kScope.template.insertTemplate(o,n)}}})}}),t.getScope().chains.search.control.add({name:"bindSearchResultElementEvents",fire:function(t,a){var c=a.recsScope.searchObject;c.getScope().chains.template.events.add({name:"storeResultItems",fire:function(t,a){var c=e.getSetting(a.kScope.parentScope,"settings.recs.apiKey",e.getGlobalSetting("recs.apiKey",e.getGlobalSetting("global.apiKey"))),s=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.recsKey"),n=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.title"),o=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.logic"),r=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.pageType"),i=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.spotKey",!1),p=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.spotName",!1),d=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.segmentKey",!1),g=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.segmentName",!1),u=e.getGlobalSetting("constants.RECS_QUERY_ID","klevuRECSItemList");e.setObjectPath(a.data,"context.section",u);var l=[];if(l.push(e.settings.constants.RECS_RPT+r),e.isFunction(e.support.isActive)&&e.support.isActive("webhook")){let t={type:"recommendation_view",component:"recs",scope:a.kObject.getWebhookSettings().scope,object:a.kObject.getWebhookSettings().object,apiKey:c,user:{},data:{general:{tags:l,list_name:n,list_logic:o,page_type:r,recs_key:s},meta:e.analytics.dataExtract.search.metaFromScope(a),filters:e.analytics.dataExtract.search.filtersFromScope(a),items:e.analytics.dataExtract.search.itemsFromScope(a)}};i?(e.setObjectPath(t,"data.general.list_id",i),e.setObjectPath(t,"data.general.spot_id",i)):e.setObjectPath(t,"data.general.list_id",s),p&&e.setObjectPath(t,"data.general.spot_name",p),d&&e.setObjectPath(t,"data.general.segment_id",d),g&&e.setObjectPath(t,"data.general.segment_name",g),!e.isUndefined(e.user)&&e.user.getSessionId()&&e.setObjectPath(t,"user.session_id",e.user.getSessionId()),e.isFunction(e.support.hook)&&e.support.hook(["analytics.collector"],(function(){e.analytics.collector.addEvent(t)})),a.kScope.parentScope.viewPayload=t}else e.logError("ERROR - webhook module not supported by current core version, please upgrade klevu core to latest version")}}),c.getScope().chains.template.events.add({name:"storeResultItemsClick",fire:function(t,a){var c=e.getSetting(a.kScope.settings,"settings.search.searchBoxTarget"),s=e.dom.find(".kuRECSItemClick",c);s&&e.each(s,(function(t,a){e.event.attach(a,"click",(function(t){var c=e.dom.helpers.getClosest(a,".klevuTarget"),s=e.getObjectPath(c.recsScope,"kmcData.metadata.recsKey"),n=a.dataset&&a.dataset.id&&""!=a.dataset.id?a.dataset.id:"",o=e.dom.helpers.getClosest(a,".kuRECSItem,.kcResultItem"),r=o.dataset&&o.dataset.id&&""!=o.dataset.id?o.dataset.id:"";if((""!=n||""!=r)&&s){""==n&&(n=r),e.dom.helpers.addClickedProductToCookie(n);let t=e.getObjectPath(c.recsScope,"viewPayload",!1);if(t){let a=e.getObjectPath(t,"data.items",[]);a.length>0&&e.each(a,(function(a,c){if(c.id==n){let a=[c];e.setObjectPath(t,"type","recommendation_click"),e.setObjectPath(t,"data.items",a),e.isFunction(e.support.hook)&&e.support.hook(["analytics.collector"],(function(){e.analytics.collector.addEvent(t)}))}}))}}}))}))}}),c.getScope().chains.template.events.add({name:"attachObserverFunctionForItemClick",fire:function(t,a){var c=e.getSetting(a.kScope.settings,"settings.search.searchBoxTarget"),s=e.dom.find(".kuRECSItemClick",c);s&&e.each(s,(function(a,c){e.event.attach(c,"click",(function(a){if("function"==typeof klevu_RECSItemClick){var s=e.dom.helpers.getClosest(c,".klevuTarget"),n=e.getObjectPath(s.recsScope,"kmcData.metadata.recsKey"),o=c.dataset&&c.dataset.id&&""!=c.dataset.id?c.dataset.id:"",r=e.dom.helpers.getClosest(c,".kuRECSItem,.kcResultItem"),i=r.dataset&&r.dataset.id&&""!=r.dataset.id?r.dataset.id:"";""==o&&""==i||!n||""==o&&(o=i),klevu_RECSItemClick(t.template,o,n)}}))}))}}),c.getScope().chains.template.events.add({name:"bindTemplateElementEvents",fire:function(t,a){if("function"==typeof klevu_bindRECSTemplateElementEvents){var c=e.getObjectPath(a.kScope.parentScope,"kmcData.metadata.recsKey");klevu_bindRECSTemplateElementEvents(t.template,c)}}})}}),t.getScope().chains.search.control.add({name:"addScriptEvaluation",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.scripts.recsObject");if(!e.isUndefined(c)&&""!==c){var s=e.randomFunctionName();e.globalEval("function "+s+"(data,scope){"+c+"}"),e.executeFunctionByName(s,window,t,a)}}}),t.getScope().chains.search.control.add({name:"setSearchBoxTarget",fire:function(e,t){t.recsScope.searchObject.setTarget(t.recsScope.element)}}),t.getScope().chains.search.control.add({name:"addWebhookBuild",fire:function(t,a){if(e.isFunction(e.support.isActive)&&e.support.isActive("webhook")){var c=a.recsScope.searchObject,s=e.extend(!0,{},c.getWebhookSettings());s.name="mainObject",s.action="build",e.event.webhook.runForScopeList({data:c.getScope().data,scope:c.getScope().element,settings:s})}else e.logError("ERROR - webhook module not supported by current core version, please upgrade klevu core to latest version")}}),t.getScope().chains.search.control.add({name:"powerUpRECSSearchObject",fire:function(t,a){var c,s=a.recsScope.searchObject,n=s.getScope().element;(n.value="*",n.kScope.data=n.kObject.resetData(n),e.isFunction(e.support.isActive)&&e.support.isActive("webhook"))?((c=e.extend(!0,{},s.getWebhookSettings())).name="mainObject",c.action="beforeInit",e.event.webhook.runForScopeList({data:s.getScope().data,scope:s.getScope().element,settings:c})):e.logError("ERROR - webhook module not supported by current core version, please upgrade klevu core to latest version");(e.event.fireChain(n.kScope,"chains.events.keyUp",n,n.kScope.data,null),e.isFunction(e.support.isActive)&&e.support.isActive("webhook"))?((c=e.extend(!0,{},s.getWebhookSettings())).name="mainObject",c.action="afterInit",e.event.webhook.runForScopeList({data:s.getScope().data,scope:s.getScope().element,settings:c})):e.logError("ERROR - webhook module not supported by current core version, please upgrade klevu core to latest version")}}),t.getScope().chains.type.hideBanner.add({name:"checkHideBanner",fire:function(t,a){e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey");if("HIDE_RECOMMENDATION"===e.getObjectPath(a.recsScope,"kmcData.metadata.action",!1))return console.info("RECS element is hidden"),!1}}),t.getScope().chains.type.staticContent.add({name:"validateRECSElementData",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey");if(!c)return console.info("RECS element id is missing."),!1;if(!e.getObjectPath(a.recsScope,"kmcData.metadata.enabled"))return console.info("["+c+"] element is disabled."),!1;var s=!1;return e.getObjectPath(a.recsScope,"kmcData.metadata.logic")||(console.info("["+c+"] RECS logic is missing."),s=!0),e.getObjectPath(a.recsScope,"kmcData.metadata.pageType")||(console.info("["+c+"] RECS page type is missing."),s=!0),!s&&void 0}}),t.getScope().chains.type.staticContent.add({name:"addElementStylesToHead",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey"),s=e.getObjectPath(a.recsScope,"kmcData.styles.base");c&&e.each(e.dom.find("#ku-recs-"+c),(function(e,t){t&&t.parentNode&&t.parentNode.removeChild(t)})),e.dom.helpers.addElementToHead({content:s,type:"css",name:"ku-recs-"+c})}}),t.getScope().chains.type.staticContent.add({name:"registerRECSTemplate",fire:function(t,a){var c=e.template();a.recsScope.template=c;var s=e.getObjectPath(a.recsScope,"kmcData.templates.base");c.setTemplate(s,"kuRECSTemplate",!0)}}),t.getScope().chains.type.staticContent.add({name:"addScriptEvaluation",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.scripts.recsObject");if(!e.isUndefined(c)&&""!==c){var s=e.randomFunctionName();e.globalEval("function "+s+"(data,scope){"+c+"}"),e.executeFunctionByName(s,window,t,a)}}}),t.getScope().chains.type.staticContent.add({name:"renderStaticContent",fire:function(t,a){var c=a.recsScope.template;if("STATIC_CONTENT"===e.getObjectPath(a.recsScope,"kmcData.metadata.action")&&t.context.isSuccess){c.setData(t.scope.recsScope.kmcData);var s=c.convertTemplate(c.render("kuRECSTemplate")),n=a.recsScope.element;n.innerHTML="",n.classList.add("klevuTarget"),c.insertTemplate(n,s)}}}),t.getScope().chains.type.staticContent.add({name:"staticContentAnalyticsView",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.action"),s=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey"),n=e.getSetting(a.recsScope,"settings.recs.apiKey",e.getGlobalSetting("recs.apiKey",e.getGlobalSetting("global.apiKey"))),o=e.getObjectPath(a.recsScope,"kmcData.metadata.title"),r=e.getObjectPath(a.recsScope,"kmcData.metadata.logic"),i=e.getObjectPath(a.recsScope,"kmcData.metadata.pageType"),p=e.getObjectPath(a.recsScope,"kmcData.metadata.spotKey",!1),d=e.getObjectPath(a.recsScope,"kmcData.metadata.spotName",!1),g=e.getObjectPath(a.recsScope,"kmcData.metadata.segmentKey",!1),u=e.getObjectPath(a.recsScope,"kmcData.metadata.segmentName",!1),l=e.getObjectPath(a.recsScope,"kmcData.staticContent",!1);let m=a.recsScope.element;if(!m)return;let h=e.dom.find('[data-view="banner"]',m),S=[];h.length&&e.each(h,(function(e,t){let a=t.querySelector("img"),c={static_item_id:t.getAttribute("data-id")||"",content_type:t.getAttribute("data-type")||"",resolution:t.getAttribute("data-resolution")||"",banner_image_url:null===a?"":t.querySelector("img").getAttribute("src"),banner_alt_tag:null===a?"":t.querySelector("img").getAttribute("alt"),index:e+1};S.push(c)}));var b=[];if(b.push(e.getGlobalSetting("constants.RECS_RPT","")+i),"STATIC_CONTENT"===c&&e.isFunction(e.support.hook)){let t={type:"recommendation_view_static",component:"recs",apiKey:n,user:{},data:{general:{tags:b,list_name:o,list_logic:r,page_type:i,recs_key:s,spot_id:p,spot_name:d},staticContent:l,activeStaticContent:S}};p?(e.setObjectPath(t,"data.general.list_id",p),e.setObjectPath(t,"data.general.spot_id",p)):e.setObjectPath(t,"data.general.list_id",s),d&&e.setObjectPath(t,"data.general.spot_name",d),g&&e.setObjectPath(t,"data.general.segment_id",g),u&&e.setObjectPath(t,"data.general.segment_name",u),c&&e.setObjectPath(t,"data.general.action",c),!e.isUndefined(e.user)&&e.user.getSessionId()&&e.setObjectPath(t,"user.session_id",e.user.getSessionId()),e.support.hook(["analytics.collector"],(function(){e.analytics.collector.addEvent(t)}))}}}),t.getScope().chains.type.staticContent.add({name:"staticContentAnalyticsClick",fire:function(t,a){var c=e.getObjectPath(a.recsScope,"kmcData.metadata.action"),s=e.getObjectPath(a.recsScope,"kmcData.metadata.recsKey"),n=e.getSetting(a.recsScope,"settings.recs.apiKey",e.getGlobalSetting("recs.apiKey",e.getGlobalSetting("global.apiKey"))),o=e.getObjectPath(a.recsScope,"kmcData.metadata.title"),r=e.getObjectPath(a.recsScope,"kmcData.metadata.logic"),i=e.getObjectPath(a.recsScope,"kmcData.metadata.pageType"),p=e.getObjectPath(a.recsScope,"kmcData.metadata.spotKey",!1),d=e.getObjectPath(a.recsScope,"kmcData.metadata.spotName",!1),g=e.getObjectPath(a.recsScope,"kmcData.metadata.segmentKey",!1),u=e.getObjectPath(a.recsScope,"kmcData.metadata.segmentName",!1),l=e.getObjectPath(a.recsScope,"kmcData.staticContent",!1),m=[];if(m.push(e.getGlobalSetting("constants.RECS_RPT","")+i),"STATIC_CONTENT"===c){let t={type:"recommendation_click_static",component:"recs",apiKey:n,user:{},data:{general:{tags:m,list_name:o,list_logic:r,page_type:i,recs_key:s,spot_id:p,spot_name:d},staticContent:l}};p?(e.setObjectPath(t,"data.general.list_id",p),e.setObjectPath(t,"data.general.spot_id",p)):e.setObjectPath(t,"data.general.list_id",s),d&&e.setObjectPath(t,"data.general.spot_name",d),g&&e.setObjectPath(t,"data.general.segment_id",g),u&&e.setObjectPath(t,"data.general.segment_name",u),c&&e.setObjectPath(t,"data.general.action",c),!e.isUndefined(e.user)&&e.user.getSessionId()&&e.setObjectPath(t,"user.session_id",e.user.getSessionId());let h=a.recsScope.element,S=e.dom.find(".kuRECSItemClick",h);S&&e.isFunction(e.support.hook)&&e.each(S,(function(a,c){e.event.attach(c,"click",(function(c){let s=e.dom.helpers.getClosest(c.target,".kuRECSItemClick"),n=s.querySelector("img"),o={static_item_id:s.getAttribute("data-id")||"",content_type:s.getAttribute("data-type")||"",resolution:s.getAttribute("data-resolution")||"",banner_image_url:null===n?"":value.querySelector("img").getAttribute("src"),banner_alt_tag:null===n?"":value.querySelector("img").getAttribute("alt"),index:a+1};e.setObjectPath(t,"data.staticContent",[o]),e.support.hook(["analytics.collector"],(function(){e.analytics.collector.addEvent(t)}))}))}))}}})}}(klevu),klevu.coreEvent.build({name:"setRemoteConfigRecsBaseUpdates",fire:function(){return!klevu.isUndefined(klevu.recs)&&!klevu.isUndefined(klevu.recs.base)},maxCount:500,delay:30}),klevu.coreEvent.build({name:"setRemoteConfigRecs",fire:function(){return!(klevu.isUndefined(klevu.recs)||!klevu.getGlobalSetting("recs.apiKey",klevu.getGlobalSetting("global.apiKey",!1))||!klevu.dom.find(".klevu-recs").length||!klevu.getSetting(klevu.settings,"settings.powerUp.recsModule"))},maxCount:50,delay:300}),klevu.coreEvent.attach("setRemoteConfigRecsBaseUpdates",{name:"klevuRECSCustomization",fire:function(){klevu.recs.base.getScope().chains.search.control.add({name:"attachCustomEvents",fire:function(e,t){var a=t.recsScope;t.recsScope.searchObject.getScope().chains.template.events.add({name:"bindAddToCartButtonEvent",fire:function(e,t){var c=klevu.getSetting(t.kScope.settings,"settings.search.searchBoxTarget"),s=klevu.dom.find(".kuRECSAddToCartBtn",c);s&&klevu.each(s,(function(e,t){klevu.event.attach(t,"click",(function(){var e=t.dataset&&t.dataset.id?t.dataset.id:"",c=t.dataset&&t.dataset.url?t.dataset.url:"",s=t.dataset&&t.dataset.qty?t.dataset.qty:0;if("function"==typeof klevu_addtocart){var n=klevu.getObjectPath(a,"kmcData.metadata.recsKey");klevu_addtocart(e,c,s,n)}}))}))}}),t.recsScope.searchObject.getScope().chains.template.events.add({name:"bindAddToCartButtonAnalytics",fire:function(e,t){var a=klevu.getSetting(t.kScope.settings,"settings.search.searchBoxTarget"),c=klevu.dom.find(".kuRECSAddToCartBtn",a);c&&klevu.each(c,(function(e,t){klevu.event.attach(t,"click",(function(){var e=klevu.dom.helpers.getClosest(t,".klevuTarget"),a=klevu.getObjectPath(e.recsScope,"kmcData.metadata.recsKey"),c=t.dataset&&t.dataset.id&&""!=t.dataset.id?t.dataset.id:"",s=klevu.dom.helpers.getClosest(t,".kuRECSItem,.kcResultItem"),n=s.dataset&&s.dataset.id&&""!=s.dataset.id?s.dataset.id:"";if((""!=c||""!=n)&&a){""==c&&(c=n),klevu.dom.helpers.addClickedProductToCookie(c);let t=klevu.getObjectPath(e.recsScope,"viewPayload",!1);if(t){let e=klevu.getObjectPath(t,"data.items",[]);e.length>0&&klevu.each(e,(function(e,a){if(a.id==c){let e=[a];klevu.setObjectPath(t,"type","recommendation_click"),klevu.setObjectPath(t,"data.items",e),klevu.isFunction(klevu.support.hook)&&klevu.support.hook(["analytics.collector"],(function(){klevu.analytics.collector.addEvent(t)}))}}))}}}))}))}})}})}}),klevu.coreEvent.attach("setRemoteConfigRecs",{name:"populateRECSObjectClone",fire:function(){klevu.each(klevu.dom.find(".klevu-recs"),(function(e,t){t.id?klevu.recs.clone({recId:t.id,apiKey:klevu.getGlobalSetting("recs.apiKey",klevu.getGlobalSetting("global.apiKey")),element:t}):console.info("No Klevu RECS ID found on the targeted element!",t)}))}}),klevu.coreEvent.attach("setRemoteConfigRecs",{name:"powerUpRECSList",fire:function(){var e=klevu.recs.list;e&&e.length&&klevu.each(e,(function(e,t){t.powerUp()}))}});
